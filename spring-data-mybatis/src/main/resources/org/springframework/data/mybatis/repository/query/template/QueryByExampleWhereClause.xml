<sql id="{{statementName}}">
    <where>
        {{#properties}}
        <if test="!__accessor.isIgnoredPath('{{key}}')">
            <if test="{{#testNotNull}}__entity.{{key}}{{/testNotNull}}">
                <if test="__matcher.isAnyMatching()">or</if>
                <if test="__matcher.isAllMatching()">and</if>
                <choose>
                    <when test="__accessor.isIgnoreCaseForPath('{{key}}')">lower({{key}})</when>
                    <otherwise>{{key}}</otherwise>
                </choose>
                {{^value.string}} =
                <choose>
                    <when test="__accessor.isIgnoreCaseForPath('{{key}}')">lower(#{__entity.{{key}}})</when>
                    <otherwise>#{__entity.{{key}}}</otherwise>
                </choose>
                {{/value.string}}
                {{#value.string}}
                <!-- only for string -->
                <bind name="__string_{{key}}" value="__accessor.getStringMatcherForPath('{{key}}').name()"/>
                <choose>
                    <when test="__string_{{key}}.equals('DEFAULT') or __string_{{key}}.equals('EXACT')">
                        =
                        <choose>
                            <when test="__accessor.isIgnoreCaseForPath('{{key}}')">lower(#{__entity.{{key}}})
                            </when>
                            <otherwise>#{__entity.{{key}}}</otherwise>
                        </choose>
                    </when>
                    <when test="__string_{{key}}.equals('STARTING')">
                        like
                        <bind name="__starting_{{key}}" value="__entity.{{key}} + '%'"/>
                        <choose>
                            <when test="__accessor.isIgnoreCaseForPath('{{key}}')">lower(#{__starting_{{key}}})
                            </when>
                            <otherwise>#{__starting_{{key}}}</otherwise>
                        </choose>
                    </when>
                    <when test="__string_{{key}}.equals('ENDING')">
                        like
                        <bind name="__ending_{{key}}" value="'%' + __entity.{{key}}"/>
                        <choose>
                            <when test="__accessor.isIgnoreCaseForPath('{{key}}')">lower(#{__ending_{{key}}})
                            </when>
                            <otherwise>#{__ending_{{key}}}</otherwise>
                        </choose>
                    </when>
                    <when test="__string_{{key}}.equals('CONTAINING')">
                        like
                        <bind name="__containing_{{key}}" value="'%' + __entity.{{key}} + '%'"/>
                        <choose>
                            <when test="__accessor.isIgnoreCaseForPath('{{key}}')">lower(#{__containing_{{key}}})
                            </when>
                            <otherwise>#{__containing_{{key}}}</otherwise>
                        </choose>
                    </when>
                </choose>
                {{/value.string}}
            </if>
            <if test="({{#testNull}}__entity.{{key}}{{/testNull}}) and __accessor.nullHandler.name().equals('INCLUDE')">
                <if test="__matcher.isAnyMatching()">or</if>
                <if test="__matcher.isAllMatching()">and</if>
                {{value.name}} is null
            </if>
        </if>
        {{/properties}}
    </where>
</sql>