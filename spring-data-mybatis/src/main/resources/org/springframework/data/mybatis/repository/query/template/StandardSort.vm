#macro(PropertyColumnMap $column $pnamePrefix $tableAliasSuffix)#if($pnamePrefix)#set($pname = "${pnamePrefix}.${column.propertyName}")#else#set($pname = $column.propertyName)#end#if($tableAliasSuffix)#set($fullTableAlias = "${domain.tableAlias}.${tableAliasSuffix}")#set($fullColumnName = "${util.quote($fullTableAlias)}.${column.name.render($dialect)}")#else#set($fullColumnName = "${util.quote($domain.tableAlias)}.${column.name.render($dialect)}")#end,"${pname}":"${util.escapeQuotes($fullColumnName)}"#end
<sql id="${statementName}">
    <if test="__sort != null">
        <bind name="__columnsMap" value='#{"____":""#foreach($entry in $domain.primaryKey.columns.entrySet())#PropertyColumnMap($entry.value)#end#foreach($entry in $domain.normalColumns.entrySet())#PropertyColumnMap($entry.value)#end#foreach($embeddingEntry in ${domain.associations.entrySet()})#if($embeddingEntry.value.embedding)#set($embedding = $embeddingEntry.value)#foreach($entry in ${embedding.target.normalColumns.entrySet()})#PropertyColumnMap($entry.value ${embeddingEntry.key.name})#end#end#end#foreach($associationEntry in ${domain.associations.entrySet()})#set($association = $associationEntry.value)#if($association.toOne && $association.join)#foreach($entry in $association.target.primaryKey.columns.entrySet())#set($column = $entry.value)#PropertyColumnMap($column ${associationEntry.key.name} ${associationEntry.key.name})#end#foreach($entry in $association.target.normalColumns.entrySet())#set($column = $entry.value)#PropertyColumnMap($column ${associationEntry.key.name} ${associationEntry.key.name})#end#foreach($embeddingEntry in ${association.target.associations.entrySet()})#if($embeddingEntry.value.embedding)#set($embedding = $embeddingEntry.value)#foreach($entry in ${embedding.target.normalColumns.entrySet()})#set($column = ${entry.value})#set($pnamePrefix = "${associationEntry.key.name}.${embeddingEntry.key.name}")#PropertyColumnMap($column $pnamePrefix  ${associationEntry.key.name})#end#end#end#end#end}'/>
        order by
        <foreach collection="__sort" item="item" index="idx" open="" close="" separator=",">
            <if test="item.ignoreCase">${dialect.lowercaseFunction}(</if>${ __columnsMap[item.property] }<if test="item.ignoreCase">)</if> ${ item.direction.name() }
        </foreach>
    </if>
</sql>
